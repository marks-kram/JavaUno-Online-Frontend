<!Doctype html>
<html lang="de" xmlns:v-bind="http://www.w3.org/1999/xhtml">
<head>
    <title>JavaUno Online</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta property="og:title" content="JavaUno Online">
    <meta property="og:description" content="Spiele das beliebte Kartenspiel mit Freunden oder auch alleine am PC oder Handy.">
    <meta property="og:image" content="/res/img/og.png">
    <meta property="og:image:secure_url" content="/res/img/og.png">
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
    <link rel="stylesheet" type="text/css" href="/res/css/general.css">
    <link rel="stylesheet" type="text/css" href="/res/css/view-start.css">
    <link rel="stylesheet" type="text/css" href="/res/css/view-set-players.css">
    <link rel="stylesheet" type="text/css" href="/res/css/view-game.css">
    <script src="/res/js/config-default.js"></script>
    <script src="config.js"></script>
    <script src="/res/js/vue-core.js"></script>
    <script src="/res/js/vue-cookies.js"></script>
    <script src="/res/js/vue-resource.js"></script>
    <script src="/res/js/toaster.js"></script>
    <script src="/res/js/toast.js"></script>
    <script src="/res/js/qr/qr-generator.js"></script>
    <script src="/res/js/countdown.js"></script>
    <script src="/res/js/sockjs.min.js"></script>
    <script src="/res/js/stomp.min.js"></script>
</head>
<body>
    <header>
        <img src="/res/img/logo.png" alt="" onclick="self.location.href='/';">
        <a href="/manual.pdf" target="_blank">Bedienungs- und Spielanleitung</a>
    </header>
    <noscript>JavaUno als Browsergame basiert auf JavaScript. Bitte aktiviere JavaScript in deinen Browsereinstellungen.</noscript>

    <div id="javaUno">

        <!-- Start/Join view - From here a game can be created or joined -->
        <div id="view-start" v-if="currentView === 'start' || currentView === 'join' || currentView === 'noToken'">
            <p v-if="!invitation">
                Spiele das beliebte Kartenspiel UNO online am PC oder Smartphone.<br>
                Du kannst mit Freunden spielen oder aber auch alleine gegen computergesteuerte Gegner.<br>
            </p>
            <p v-if="invitation">
                Mach' mit beim beliebten Kartenspiel UNO.<br>
                Du wurdest eingeladen, mitzuspielen. Viel Spaß!
            </p>
            <div v-if="currentView === 'start'">
                <p>
                    <span v-if="enableTokenizedGameCreate">Um zu spielen brauchst du eine Einladung zum Mitspielen oder
                        einen Token zur Berechtigung, ein neues Uno-Spiels zu erstellen.</span>
                    <span v-if="!enableTokenizedGameCreate">Erstelle ein neues Uno-Spiel oder erhalte eine Einladung zum Mitspielen.</span>
                </p>
                <p>
                    <button v-if="currentView === 'start' && !tokenLockedGameCreate" @click="createGame()"
                            v-bind:disabled="tokenLockedGameCreate || btnCreateGameDisabled">Uno-Spiel erstellen</button><br>
                    <span v-if="tokenLockedGameCreate" class="smallButtonDescription">(Berechtigungstoken erforderlich)</span>
                </p>
                <p v-if="hasCamera">
                    <button @click="scanQr()" class="small">QR-Code scannen</button><br>
                    <span v-if="tokenLockedGameCreate" class="smallButtonDescription">(Für Tokens, und Einladungen)</span>
                    <span v-if="!tokenLockedGameCreate" class="smallButtonDescription">(Für Einladungen)</span>
                </p>
                <p>
                    <button @click="prepareSwitchDevice()" class="small">Gerät wechseln</button><br>
                    <span  class="smallButtonDescription">(Bestehendes Spiel hierhin wechseln)</span>
                </p>
            </div>
            <div v-if="currentView === 'join'">
                <input type="text" v-model="name" placeholder="Name (optional)">
                <button @click="joinGame()"
                        v-bind:disabled="gameState.players.length >= 8 || gameState.game.gameLifecycle === 'RUNNING' || btnJoinGameDisabled">
                    <span v-if="invitation">Jetzt mitspielen</span>
                    <span v-if="!invitation">Jetzt loslegen</span>
                </button>
            </div>
            <div  class="errMsg" v-if="currentView === 'join' && gameState.players.length >= 8">
                Die maximale Spieleranzahl (8) wurde erreicht.
            </div>
            <div  class="errMsg" v-if="currentView === 'join' && gameState.game.gameLifecycle === 'RUNNING'">
                Das Spiel wurde bereits gestartet.
            </div>
            <div  class="errMsg"
                  v-if="currentView === 'join' && (gameState.players.length >= 8 || gameState.game.gameLifecycle === 'RUNNING')">
                Es können leider keine weiteren Spieler teilnehmen.<br>
                <button class="small" @click="reset()">Eigenes Spiel starten</button>
            </div>
        </div>

        <!-- Set players view - From here Players can be added and removed and game round can be started -->
        <div id="view-set-players" v-if="currentView === 'set_players'">
            <h3>Aktuelle Spieler ({{gameState.players.length}})</h3>
            <div id="current-players">
                <div class="player" v-for="(player, index) in gameState.players">
                    {{ getPlayerName(player.name, index) }}
                    <span v-if="index === gameState.myIndex">(Du)</span>
                    <button v-if="index === gameState.myIndex" class="small" @click="leaveGame()">Spiel verlassen</button>
                    <button v-if="player.bot" class="small" @click="removeBot(player)">Bot entfernen</button>
                </div>
            </div>
            <h3>Spieler hinzufügen</h3>
            <div id="add-players" v-if="gameState.players.length < 8">
                Freunde einladen:<br>
                Schicke deinen Freunden folgenden Link oder lasse sie den QR-Code scannen:<br>
                <textarea id="invitation-link-toCopy">{{protocol}}://{{hostname}}/invitation.html#game:{{gameUuid}}</textarea>
                <span id="invitation-link">{{protocol}}://{{hostname}}/invitation.html#game:{{gameUuid}}</span><br><br>
                <button class="small" @click="copyLink()">Link Kopieren</button>&emsp;
                <button class="small" @click="showInvitationQrCode()">QR-Code anzeigen</button>
                <div v-show="showInvitationQr">
                    <div >
                        <img v-bind:src="qr" alt="" class="qr-image">
                    </div>
                    <button class="small" @click="showInvitationQr = false">ausblenden</button>
                </div>
                <br><br>
                Alternativ kannst du einen computergesteuerten Gegner hinzufügen:<br>
                <input class="small" type="text" v-model="botName" placeholder="Name (optional)">
                <button class="small" @click="addBot()">Hinzufügen</button>
            </div>
            <div id="add-players-limit-reached" v-if="gameState.players.length >= 8">
                Die maximale Spieleranzahl (8) wurde erreicht.<br>
                Es können keine weiteren Spieler teilnehmen.
            </div>
            <div id="start-game">
                <button @click="startGame()"
                        v-bind:disabled="gameState.players.length < 2">Spiel starten</button>
                <div class="errMsg" v-if="gameState.players.length < 2">
                    Es werden mindestens 2 Spieler benötigt.
                </div>
            </div>
            <p class="largeMarginBottom">
                <button @click="prepareSwitchDevice()" class="small">Gerät wechseln</button>
            </p>
        </div>

        <!-- running game view - shows the running game -->
        <div id="view-running" v-if="currentView === 'running'">
            <div id="players">
                <div class="player" v-for="(player, index) in gameState.players" v-if="!gameState.game.reversed">
                    <div class="current">
                        <div v-bind:style="'width: ' + (isPlayersTurn(index) ? timeLeftPercent : 0) + '%'"></div>
                    </div>
                    <div class="name">
                        {{ getPlayerName(player.name, index) }}
                    </div>
                    <div v-bind:class="'cards ' + (player.cardCount > 9 ? ' more' : '') + (player.cardCount === 1 && player.unoSaid ? ' red' : '')">
                        {{ player.cardCount }}
                    </div>
                </div>
                <div class="player" v-for="(player, index) in gameState.players.slice().reverse()" v-if="gameState.game.reversed">
                    <div class="current">
                        <div v-bind:style="'width: ' + (isPlayersTurn(gameState.players.length-index-1) ? timeLeftPercent : 0) + '%'"></div>
                    </div>
                    <div class="name">
                        {{ getPlayerName(player.name, gameState.players.length-index-1) }}
                    </div>
                    <div v-bind:class="'cards ' + (player.cardCount > 9 ? ' more' : '') + (player.cardCount === 1 && player.unoSaid ? ' red' : '')">
                        {{ player.cardCount }}
                    </div>
                </div>
            </div>
            <div id="table">
                <div id="topCard">
                    <div v-bind:class="gameState.game.desiredColor !== null ? gameState.game.desiredColor.toLowerCase() : ''"></div>
                    <picture>
                        <source v-bind:srcset="getCardImage(gameState.game.topCard, 'large')" media="(min-width: 860px) and (min-height: 908px)">
                        <source v-bind:srcset="getCardImage(gameState.game.topCard, 'small')" media="(max-width: 859px), (max-height: 907px)">
                        <img v-bind:src="getCardImage(gameState.game.topCard, 'small')" alt="">
                    </picture>
                </div>
                <div id="say-uno">
                    <div>
                        <button @click="sayUno()" v-bind:disabled="!isSayUnoAllowed()">Uno sagen</button>
                    </div>
                </div>
                <div id="drawPile" v-bind:class="isDrawAllowed() ? 'enabled' : 'disabled'" @click="draw()">
                    <div class="penalties" v-if="gameState.game.turnState === 'DRAW_PENALTIES' && isMyTurn()">
                        {{gameState.players[gameState.myIndex].drawPenalties}}
                    </div>
                    <div class="duties" v-if="gameState.game.turnState.startsWith('DRAW_DUTIES') && isMyTurn()">
                        {{gameState.game.drawDuties}}
                    </div>
                </div>
                <div id="color-selection" v-if="gameState.game.turnState === 'SELECT_COLOR' && isMyTurn()">
                    <div>
                        <div>
                            <div class="red" @click="selectColor('red')"></div>
                            <div class="green" @click="selectColor('green')"></div>
                        </div>
                        <div>
                            <div class="blue" @click="selectColor('blue')"></div>
                            <div class="yellow" @click="selectColor('yellow')"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div id="ownCards">
                <div class="current">
                    <div v-bind:style="'width: ' + (gameState.myIndex === gameState.game.currentPlayerIndex ? timeLeftPercent : 0) + '%'"></div>
                </div>
                <div class="card" v-for="(card, index) in gameState.ownCards">
                    <picture v-bind:class="isPutAllowed(card, index) ? 'enabled' : 'disabled'" @click="put(card, index)">
                        <source v-bind:srcset="getCardImage(card, 'large')" media="(min-width: 860px) and (min-height: 908px)">
                        <source v-bind:srcset="getCardImage(card, 'small')" media="(max-width: 859px), (max-height: 907px)">
                        <img v-bind:src="getCardImage(card, 'small')" alt="">
                    </picture>
                    <span v-if="isMyTurn() && gameState.game.turnState === 'PUT_DRAWN' && index === (gameState.ownCards.length-1)">&emsp;&emsp;&emsp;&emsp;&emsp;</span>
                    <button
                            v-if="isMyTurn() && gameState.game.turnState === 'PUT_DRAWN' && index === (gameState.ownCards.length-1)"
                            class="small"
                            @click="keep()">&larr; Behalten</button>
                </div>
            </div>
            <button @click="prepareSwitchDevice()" class="small" id="in-game-switch-device">Gerät wechseln</button>
        </div>

        <!-- switch device view -->
        <div id="view-switch-device" v-if="currentView === 'switch-device'">
            <button v-if="!showSwitchInQr && !showSwitchOutQr" class="small" @click="abortSwitchDevice()">Abbrechen</button><br><br>
            <span v-if="!showSwitchOutQr && !showSwitchInQr">Der Wechsel ist kinderleicht. Voraussetzung: Mindestens eines der beiden Geräte braucht eine Kamera.<br><br></span>
            <div v-if="gameUuid !== null && gameUuid !== '' && !showSwitchInQr">
                <button class="small" @click="prepareSwitchOut()" v-if="!showSwitchOutQr">QR-Code anzeigen</button><br>
                <div v-show="showSwitchOutQr">
                    Scanne den QR-Code, um den Wechsel durchzuführen.
                    <div>
                        <img v-bind:src="qr" alt="" class="qr-image">
                    </div>
                    <button class="small" @click="abortSwitchOut()">Abbrechen</button>
                </div>
            </div>
            <div v-if="gameUuid === null || gameUuid === '' && !showSwitchOutQr">
                <button class="small" @click="prepareSwitchIn()" v-if="!showSwitchInQr">QR-Code anzeigen</button><br>
                <div v-show="showSwitchInQr">
                    Scanne den QR-Code, um den Wechsel durchzuführen.
                    <div>
                        <img v-bind:src="qr" alt="" class="qr-image">
                    </div>
                    <button class="small" @click="abortSwitchIn()">Abbrechen</button>
                </div>
            </div>
            <p>
                <button v-if="hasCamera && !showSwitchOutQr && !showSwitchInQr" class="small" @click="scanQr()">QR-Code scannen</button>
            </p>
        </div>


        <!-- lightbox to show winner -->
        <div id="finished" class="lightbox" v-if="winner >= 0">
            <div>
                <div v-if="winner === gameState.myIndex">
                    Herzlichen Glückwunsch, {{getPlayerName(gameState.players[winner].name, winner)}}!<br>
                    Du hast gewonnen!
                </div>
                <div v-if="winner !== gameState.myIndex">
                    {{getPlayerName(gameState.players[winner].name, winner)}} hat gewonnen!
                </div>
                <button class="small" @click="winner = -1">OK</button>
            </div>
        </div>

        <!-- Backend down - error message -->
        <div v-if="currentView === 'backend-down'" id="view-backend-down">
            <div>
                <img src="/res/img/backend-down.png" alt="Backend is down" title="">
            </div>
            <div>
                Das Backend ist leider derzeit nicht erreichbar.<br>
                Bitte versuche es später wieder.
            </div>
        </div>

        <!-- processing -->
        <div id="processingBg" v-if="processing"></div>
        <div id="processingAnimation" v-if="processing"></div>
        <div id="processingEndAnimation" v-if="processingEnd"></div>

        <!-- dialogs -->
        <div v-if="dialog!==null">
            <div id="dialogBackground" @click="dialog=null"></div>
            <div id="dialogElement">
                <div v-bind:class="dialog.error ? 'errMsg' : ''">{{dialog.text}}</div>
                <button type="button" class="small" @click="dialog=null">OK</button>
            </div>
        </div>
    </div>

    <div id="toasts"></div>

    <script src="/res/js/app.js"></script>
    <script src="/res/js/qr/qr.js"></script>
    <script type="module" src="/res/js/qr/qr-scan.js"></script>
    <script src="/res/js/app-processing.js"></script>
    <script src="/res/js/app-requests.js"></script>
    <script src="/res/js/app-game.js"></script>
    <script src="/res/js/app-player.js"></script>
    <script src="/res/js/app-turn.js"></script>
    <script src="/res/js/push.js"></script>

    <div id="legalHint">
        Private fun project by Tomatenmark - Not related to Mattel or their original game.
    </div>

    <div id="qrScanBg"></div>
    <video id="qrScanVideo"></video>
    <button id="qrScanBtn"></button>
    <button class="small" id="qrScanStopBtn">Abbrechen</button>


</body>
</html>